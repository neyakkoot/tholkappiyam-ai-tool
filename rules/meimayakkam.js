const MeimayakkamRules = {
    check: function(word) {
        
        // மெய்யெழுத்துகளைக் கண்டறியும் Regex
        // (குறிப்பு: தமிழ் யூனிகோடில் புள்ளி வைத்த எழுத்துகளை அடையாளம் காணுதல்)
        const meiRegex = /[க்ங்ச்ஞ்ஜ்ட்ண்த்ந்ப்ம்ய்ர்ல்வ்ழ்ள்ற்ன்]/g;
        let match;

        while ((match = meiRegex.exec(word)) !== null) {
            const mei = match[0]; // தற்போதைய மெய் (எ.கா: 'ட்')
            const index = match.index;
            
            // சொல்லின் இறுதியில் இருந்தால் பிரச்சனை இல்லை (மொழியிறுதி விதி பார்க்கும்)
            if (index + 1 >= word.length) continue;

            const nextChar = word[index + 1]; 
            
            // அடுத்த எழுத்து மெய்யாகவோ அல்லது உயிர்மெய்யாகவோ இருக்கலாம்.
            // அதன் அடிப்படை மெய்யை (Root Consonant) எடுக்கிறோம்.
            const nextBase = getBaseConsonant(nextChar);

            if (!nextBase) continue; // அடுத்தது உயிரெழுத்து என்றால் விட்டுவிடு

            // ---------------------------------------------------------
            // விதி சரிபார்ப்பு (பைத்தான் நிரல் அடிப்படையில்)
            // ---------------------------------------------------------
            let isValidCluster = false;
            let ruleDescription = "";

            switch (mei) {
                // -----------------------------------------------------
                // 1. வல்லினம்: ட், ற் (Rule 1 from Python)
                // ட், ற் + க, ச, ப (மற்றும் தம் வர்க்கம்)
                // எ.கா: கேட்க, கற்க
                // -----------------------------------------------------
                case 'ட்': 
                    isValidCluster = ['க்', 'ச்', 'ப்', 'ட்'].includes(nextBase);
                    ruleDescription = "விதி 1: 'ட்' ஒற்றின் பின் க, ச, ப மற்றும் ட மட்டுமே மயங்கும்.";
                    break;
                case 'ற்': 
                    isValidCluster = ['க்', 'ச்', 'ப்', 'ற்'].includes(nextBase);
                    ruleDescription = "விதி 1: 'ற்' ஒற்றின் பின் க, ச, ப மற்றும் ற மட்டுமே மயங்கும்.";
                    break;

                // -----------------------------------------------------
                // 2. இடையினம்: ல், ள் (Rule 1 & 2 from Python)
                // ல், ள் + க, ச, ப (Rule 1)
                // ல், ள் + ய, வ (Rule 2)
                // எ.கா: செல்க, வெள்வளை
                // -----------------------------------------------------
                case 'ல்': 
                    isValidCluster = ['க்', 'ச்', 'ப்', 'ய்', 'வ்', 'ல்'].includes(nextBase);
                    ruleDescription = "விதி 1 & 2: 'ல்' ஒற்றின் பின் க, ச, ப, ய, வ மற்றும் ல மட்டுமே மயங்கும்.";
                    break;
                case 'ள்': 
                    isValidCluster = ['க்', 'ச்', 'ப்', 'ய்', 'வ்', 'ள்'].includes(nextBase);
                    ruleDescription = "விதி 1 & 2: 'ள்' ஒற்றின் பின் க, ச, ப, ய, வ மற்றும் ள மட்டுமே மயங்கும்.";
                    break;

                // -----------------------------------------------------
                // 3. மெல்லினம்: ங், ஞ், ண், ந், ம், ன் (Rule 3, 4, 5)
                // -----------------------------------------------------
                case 'ங்': 
                    // Rule 3: ங் + க் (மாங்காய்) + தம் வர்க்கம் (ங்)
                    isValidCluster = ['க்', 'ங்'].includes(nextBase);
                    ruleDescription = "விதி 3: 'ங்' ஒற்றின் பின் அதன் இனமான 'க' மட்டுமே மயங்கும்.";
                    break;

                case 'ஞ்': 
                    // Rule 3: ஞ் + ச் (பிஞ்சு)
                    // Rule 4: ஞ் + ய் (உரிஞ்யாது)
                    isValidCluster = ['ச்', 'ஞ்', 'ய்'].includes(nextBase);
                    ruleDescription = "விதி 3 & 4: 'ஞ்' ஒற்றின் பின் ச, ஞ, ய மட்டுமே மயங்கும்.";
                    break;

                case 'ண்': 
                    // Rule 3: ண் + ட் (மண்டை) + தம் வர்க்கம்
                    isValidCluster = ['ட்', 'ண்'].includes(nextBase);
                    ruleDescription = "விதி 3: 'ண்' ஒற்றின் பின் அதன் இனமான 'ட' மற்றும் 'ண' மட்டுமே மயங்கும்.";
                    break;

                case 'ந்': 
                    // Rule 3: ந் + த் (வந்து)
                    // Rule 4: ந் + ய் (பொருந்த்யாது - அரிய வழக்கு, பைத்தான் நிரல் ஏற்கிறது)
                    isValidCluster = ['த்', 'ந்', 'ய்'].includes(nextBase);
                    ruleDescription = "விதி 3 & 4: 'ந்' ஒற்றின் பின் த, ந, ய மட்டுமே மயங்கும்.";
                    break;

                case 'ம்': 
                    // Rule 3: ம் + ப் (வம்பு)
                    // Rule 4: ம் + ய்
                    // Rule 5: ம் + வ் (நிலம்வலிது - பைத்தான் நிரல் ஏற்கிறது)
                    isValidCluster = ['ப்', 'ம்', 'ய்', 'வ்'].includes(nextBase);
                    ruleDescription = "விதி 3, 4 & 5: 'ம்' ஒற்றின் பின் ப, ம, ய, வ மட்டுமே மயங்கும்.";
                    break;

                case 'ன்': 
                    // Rule 3: ன் + ற் (சென்ற) + தம் வர்க்கம்
                    isValidCluster = ['ற்', 'ன்'].includes(nextBase);
                    ruleDescription = "விதி 3: 'ன்' ஒற்றின் பின் அதன் இனமான 'ற' மற்றும் 'ன' மட்டுமே மயங்கும். ('ர' வராது).";
                    break;

                // -----------------------------------------------------
                // 4. இடையினம்: வ் (Rule 4)
                // -----------------------------------------------------
                case 'வ்': 
                    // Rule 4: வ் + ய் (தெவ்யாது) + தம் வர்க்கம்
                    isValidCluster = ['ய்', 'வ்'].includes(nextBase);
                    ruleDescription = "விதி 4: 'வ்' ஒற்றின் பின் ய மற்றும் வ மட்டுமே மயங்கும்.";
                    break;

                // -----------------------------------------------------
                // 5. இடையினம்: ய், ர், ழ் (Rule 6 & 7)
                // இவை க, ச, த, ப, ங, ஞ, ந, ம, ய, வ உடன் மயங்கும்.
                // Rule 7: ர, ழ தம்முடன் தாம் மயங்காது (அலங்கடை).
                // -----------------------------------------------------
                case 'ய்':
                    // Rule 6 allow list + self (ய்+ய் மெய்ய்யர் - சரி)
                    isValidCluster = ['க்','ச்','த்','ப்','ஞ்','ந்','ம்','ய்','வ்','ங்'].includes(nextBase);
                    ruleDescription = "விதி 6: 'ய்' ஒற்றின் பின் க,ச,த,ப, ங,ஞ,ந,ம, ய,வ வரலாம்.";
                    break;

                case 'ர்':
                    // Rule 7: ர, ழ அலங்கடை (No gemination)
                    if (nextBase === 'ர்') {
                        isValidCluster = false;
                        ruleDescription = "விதி 7: 'ர்' (r) மெய் தன்னோடு தான் மயங்காது (இரட்டிப்பு ஆகாது).";
                    } else {
                        // Rule 6 check
                        isValidCluster = ['க்','ச்','த்','ப்','ஞ்','ந்','ம்','ய்','வ்','ங்'].includes(nextBase);
                        ruleDescription = "விதி 6: 'ர்' ஒற்றின் பின் க,ச,த,ப, ங,ஞ,ந,ம, ய,வ வரலாம்.";
                    }
                    break;

                case 'ழ்':
                    // Rule 7: ர, ழ அலங்கடை (No gemination)
                    if (nextBase === 'ழ்') {
                        isValidCluster = false;
                        ruleDescription = "விதி 7: 'ழ்' (zh) மெய் தன்னோடு தான் மயங்காது (இரட்டிப்பு ஆகாது).";
                    } else {
                        // Rule 6 check
                        isValidCluster = ['க்','ச்','த்','ப்','ஞ்','ந்','ம்','ய்','வ்','ங்'].includes(nextBase);
                        ruleDescription = "விதி 6: 'ழ்' ஒற்றின் பின் க,ச,த,ப, ங,ஞ,ந,ம, ய,வ வரலாம்.";
                    }
                    break;
                
                // -----------------------------------------------------
                // வல்லினம்: க், ச், த், ப் (தம்மொடு தாம் மட்டும்)
                // -----------------------------------------------------
                case 'க்': isValidCluster = (nextBase === 'க்'); ruleDescription = "வல்லினம்: 'க்' ஒற்றின் பின் 'க' வர்க்கம் மட்டுமே வரும்."; break;
                case 'ச்': isValidCluster = (nextBase === 'ச்'); ruleDescription = "வல்லினம்: 'ச்' ஒற்றின் பின் 'ச' வர்க்கம் மட்டுமே வரும்."; break;
                case 'த்': isValidCluster = (nextBase === 'த்'); ruleDescription = "வல்லினம்: 'த்' ஒற்றின் பின் 'த' வர்க்கம் மட்டுமே வரும்."; break;
                case 'ப்': isValidCluster = (nextBase === 'ப்'); ruleDescription = "வல்லினம்: 'ப்' ஒற்றின் பின் 'ப' வர்க்கம் மட்டுமே வரும்."; break;

                default: 
                    isValidCluster = true; // அறியாத மெய்களுக்கு அனுமதி (பாதுகாப்பிற்காக)
            }

            if (!isValidCluster) {
                return {
                    isValid: false,
                    reason: `மெய்ம்மயக்கப் பிழை: '${mei}' என்ற மெய்யைத் தொடர்ந்து '${nextChar}' வருவது மரபு அன்று. (${ruleDescription})`
                };
            }
        }

        return { isValid: true };
    }
};

// ---------------------------------------------------------
// Helper Function: உயிர்மெய்யிலிருந்து மெய்யைப் பிரித்தறிதல்
// (Python code's tamil.utf8.splitMeiUyir logic adapted)
// ---------------------------------------------------------
function getBaseConsonant(char) {
    const mapping = {
        'க': 'க்', 'கா': 'க்', 'கி': 'க்', 'கீ': 'க்', 'கு': 'க்', 'கூ': 'க்', 'கெ': 'க்', 'கே': 'க்', 'கை': 'க்', 'கொ': 'க்', 'கோ': 'க்', 'கௌ': 'க்', 'க்': 'க்',
        'ச': 'ச்', 'சா': 'ச்', 'சி': 'ச்', 'சீ': 'ச்', 'சு': 'ச்', 'சூ': 'ச்', 'செ': 'ச்', 'சே': 'ச்', 'சை': 'ச்', 'சொ': 'ச்', 'சோ': 'ச்', 'சௌ': 'ச்', 'ச்': 'ச்',
        'ட': 'ட்', 'டா': 'ட்', 'டி': 'ட்', 'டீ': 'ட்', 'டு': 'ட்', 'டூ': 'ட்', 'டெ': 'ட்', 'டே': 'ட்', 'டை': 'ட்', 'டொ': 'ட்', 'டோ': 'ட்', 'டௌ': 'ட்', 'ட்': 'ட்',
        'த': 'த்', 'தா': 'த்', 'தி': 'த்', 'தீ': 'த்', 'து': 'த்', 'தூ': 'த்', 'தெ': 'த்', 'தே': 'த்', 'தை': 'த்', 'தொ': 'த்', 'தோ': 'த்', 'தௌ': 'த்', 'த்': 'த்',
        'ப': 'ப்', 'பா': 'ப்', 'பி': 'ப்', 'பீ': 'ப்', 'பு': 'ப்', 'பூ': 'ப்', 'பெ': 'ப்', 'பே': 'ப்', 'பை': 'ப்', 'பொ': 'ப்', 'போ': 'ப்', 'பௌ': 'ப்', 'ப்': 'ப்',
        'ற': 'ற்', 'றா': 'ற்', 'றி': 'ற்', 'றீ': 'ற்', 'று': 'ற்', 'றூ': 'ற்', 'றெ': 'ற்', 'றே': 'ற்', 'றை': 'ற்', 'றொ': 'ற்', 'றோ': 'ற்', 'றௌ': 'ற்', 'ற்': 'ற்',
        'ஞ': 'ஞ்', 'ஞா': 'ஞ்', 'ஞி': 'ஞ்', 'ஞீ': 'ஞ்', 'ஞு': 'ஞ்', 'ஞூ': 'ஞ்', 'ஞெ': 'ஞ்', 'ஞே': 'ஞ்', 'ஞை': 'ஞ்', 'ஞொ': 'ஞ்', 'ஞோ': 'ஞ்', 'ஞௌ': 'ஞ்', 'ஞ்': 'ஞ்',
        'ங': 'ங்', 'ஙா': 'ங்', 'ஙி': 'ங்', 'ஙீ': 'ங்', 'ஙு': 'ங்', 'ஙூ': 'ங்', 'ஙெ': 'ங்', 'ஙே': 'ங்', 'ஙை': 'ங்', 'ஙொ': 'ங்', 'ஙோ': 'ங்', 'ஙௌ': 'ங்', 'ங்': 'ங்',
        'ண': 'ண்', 'ணா': 'ண்', 'ணி': 'ண்', 'ணீ': 'ண்', 'ணு': 'ண்', 'ணூ': 'ண்', 'ணெ': 'ண்', 'ணே': 'ண்', 'ணை': 'ண்', 'ணொ': 'ண்', 'ணோ': 'ண்', 'ணௌ': 'ண்', 'ண்': 'ண்',
        'ந': 'ந்', 'நா': 'ந்', 'நி': 'ந்', 'நீ': 'ந்', 'நு': 'ந்', 'நூ': 'ந்', 'நெ': 'ந்', 'நே': 'ந்', 'நை': 'ந்', 'நொ': 'ந்', 'நோ': 'ந்', 'நௌ': 'ந்', 'ந்': 'ந்',
        'ம': 'ம்', 'மா': 'ம்', 'மி': 'ம்', 'மீ': 'ம்', 'மு': 'ம்', 'மூ': 'ம்', 'மெ': 'ம்', 'மே': 'ம்', 'மை': 'ம்', 'மொ': 'ம்', 'மோ': 'ம்', 'மௌ': 'ம்', 'ம்': 'ம்',
        'ன': 'ன்', 'னா': 'ன்', 'னி': 'ன்', 'னீ': 'ன்', 'னு': 'ன்', 'னூ': 'ன்', 'னெ': 'ன்', 'னே': 'ன்', 'னை': 'ன்', 'னொ': 'ன்', 'னோ': 'ன்', 'னௌ': 'ன்', 'ன்': 'ன்',
        'ய': 'ய்', 'யா': 'ய்', 'யி': 'ய்', 'யீ': 'ய்', 'யு': 'ய்', 'யூ': 'ய்', 'யெ': 'ய்', 'யே': 'ய்', 'யை': 'ய்', 'யொ': 'ய்', 'யோ': 'ய்', 'யௌ': 'ய்', 'ய்': 'ய்',
        'ர': 'ர்', 'ரா': 'ர்', 'ரி': 'ர்', 'ரீ': 'ர்', 'ரு': 'ர்', 'ரூ': 'ர்', 'ரெ': 'ர்', 'ரே': 'ர்', 'ரை': 'ர்', 'ரொ': 'ர்', 'ரோ': 'ர்', 'ரௌ': 'ர்', 'ர்': 'ர்',
        'ல': 'ல்', 'லா': 'ல்', 'லி': 'ல்', 'லீ': 'ல்', 'லு': 'ல்', 'லூ': 'ல்', 'லெ': 'ல்', 'லே': 'ல்', 'லை': 'ல்', 'லொ': 'ல்', 'லோ': 'ல்', 'லௌ': 'ல்', 'ல்': 'ல்',
        'வ': 'வ்', 'வா': 'வ்', 'வி': 'வ்', 'வீ': 'வ்', 'வு': 'வ்', 'வூ': 'வ்', 'வெ': 'வ்', 'வே': 'வ்', 'வை': 'வ்', 'வொ': 'வ்', 'வோ': 'வ்', 'வௌ': 'வ்', 'வ்': 'வ்',
        'ழ': 'ழ்', 'ழா': 'ழ்', 'ழி': 'ழ்', 'ழீ': 'ழ்', 'ழு': 'ழ்', 'ழூ': 'ழ்', 'ழெ': 'ழ்', 'ழே': 'ழ்', 'ழை': 'ழ்', 'ழொ': 'ழ்', 'ழோ': 'ழ்', 'ழௌ': 'ழ்', 'ழ்': 'ழ்',
        'ள': 'ள்', 'ளா': 'ள்', 'ளி': 'ள்', 'ளீ': 'ள்', 'ளு': 'ள்', 'ளூ': 'ள்', 'ளெ': 'ள்', 'ளே': 'ள்', 'ளை': 'ள்', 'ளொ': 'ள்', 'ளோ': 'ள்', 'ளௌ': 'ள்', 'ள்': 'ள்'
    };

    return mapping[char] || null;
}
