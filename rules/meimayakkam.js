const MeimayakkamRules = {
    check: function(word) {
        
        // பொது விதி: ஙகர உயிர்மெய் இடையில் வரக்கூடாது
        if (/.[ஙஙாஙிஙீஙுஙூஙெஙேஙைஙொஙோஙௌ]/.test(word)) {
            return {
                title: "மெய்ம்மயக்க ஆய்வு",
                isValid: false,
                description: "பிழை: 'ங்' (ஒற்று) தவிர்த்த பிற ஙகர உயிர்மெய்கள் சொல்லின் இடையில் வருவது தமிழ் மரபு அன்று."
            };
        }

        const meiRegex = /[க்ங்ச்ஞ்ஜ்ட்ண்த்ந்ப்ம்ய்ர்ல்வ்ழ்ள்ற்ன்]/g;
        let match;

        while ((match = meiRegex.exec(word)) !== null) {
            const mei = match[0];
            const index = match.index;
            if (index + 1 >= word.length) continue;
            const nextChar = word[index + 1];
            const nextBase = getBaseConsonant(nextChar);

            if (!nextBase) continue;

            let isValidCluster = false;
            let ruleDescription = "";

            switch (mei) {
                case 'ட்': 
                    isValidCluster = ['க்', 'ச்', 'ப்', 'ட்'].includes(nextBase);
                    ruleDescription = "'ட்' ஒற்றின் பின் க, ச, ப மற்றும் ட மட்டுமே மயங்கும்.";
                    break;
                case 'ற்': 
                    isValidCluster = ['க்', 'ச்', 'ப்', 'ற்'].includes(nextBase);
                    ruleDescription = "'ற்' ஒற்றின் பின் க, ச, ப மற்றும் ற மட்டுமே மயங்கும்.";
                    break;
                case 'ல்': 
                    isValidCluster = ['க்', 'ச்', 'ப்', 'ய்', 'வ்', 'ல்'].includes(nextBase);
                    ruleDescription = "'ல்' ஒற்றின் பின் க, ச, ப, ய, வ மற்றும் ல மட்டுமே மயங்கும்.";
                    break;
                case 'ள்': 
                    isValidCluster = ['க்', 'ச்', 'ப்', 'ய்', 'வ்', 'ள்'].includes(nextBase);
                    ruleDescription = "'ள்' ஒற்றின் பின் க, ச, ப, ய, வ மற்றும் ள மட்டுமே மயங்கும்.";
                    break;
                case 'ங்': 
                    isValidCluster = ['க்', 'ங்'].includes(nextBase);
                    ruleDescription = "'ங்' ஒற்றின் பின் அதன் இனமான 'க' மட்டுமே மயங்கும்.";
                    break;
                case 'ஞ்': 
                    isValidCluster = ['ச்', 'ஞ்', 'ய்'].includes(nextBase);
                    ruleDescription = "'ஞ்' ஒற்றின் பின் ச, ஞ, ய மட்டுமே மயங்கும்.";
                    break;
                case 'ண்': 
                    isValidCluster = ['ட்', 'ண்', 'க்', 'ச்', 'ப்', 'ம்', 'ய', 'வ'].includes(nextBase);
                    ruleDescription = "'ண்' ஒற்றின் பின் ட, ண மற்றும் வல்லினம் மயங்கும்.";
                    break;
                case 'ந்': 
                    isValidCluster = ['த்', 'ந்', 'ய்'].includes(nextBase);
                    ruleDescription = "'ந்' ஒற்றின் பின் த, ந, ய மட்டுமே மயங்கும்.";
                    break;
                case 'ம்': 
                    isValidCluster = ['ப்', 'ம்', 'ய்', 'வ்', 'க்', 'ச்', 'த்'].includes(nextBase);
                    ruleDescription = "'ம்' ஒற்றின் பின் ப, ம, ய, வ போன்றவை மயங்கும்.";
                    break;
                case 'ன்': 
                    isValidCluster = ['ற்', 'ன்', 'க்', 'ச்', 'ப்', 'ம்', 'ய', 'வ'].includes(nextBase);
                    ruleDescription = "'ன்' ஒற்றின் பின் ற, ன மற்றும் வல்லினம் மயங்கும்.";
                    break;
                case 'வ்': 
                    isValidCluster = ['ய்', 'வ்'].includes(nextBase);
                    ruleDescription = "'வ்' ஒற்றின் பின் ய மற்றும் வ மட்டுமே மயங்கும்.";
                    break;
                case 'ய்':
                    isValidCluster = ['க்','ச்','த்','ப்','ஞ்','ந்','ம்','ய்','வ்','ங்'].includes(nextBase);
                    ruleDescription = "'ய்' ஒற்றின் பின் க,ச,த,ப, ங,ஞ,ந,ம, ய,வ வரலாம்.";
                    break;
                case 'ர்':
                    if (nextBase === 'ர்') {
                        isValidCluster = false;
                        ruleDescription = "'ர்' (r) மெய் தன்னோடு தான் மயங்காது.";
                    } else {
                        isValidCluster = ['க்','ச்','த்','ப்','ஞ்','ந்','ம்','ய்','வ்','ங்'].includes(nextBase);
                        ruleDescription = "'ர்' ஒற்றின் பின் க,ச,த,ப, ங,ஞ,ந,ம, ய,வ வரலாம்.";
                    }
                    break;
                case 'ழ்':
                    if (nextBase === 'ழ்') {
                        isValidCluster = false;
                        ruleDescription = "'ழ்' (zh) மெய் தன்னோடு தான் மயங்காது.";
                    } else {
                        isValidCluster = ['க்','ச்','த்','ப்','ஞ்','ந்','ம்','ய்','வ்','ங்'].includes(nextBase);
                        ruleDescription = "'ழ்' ஒற்றின் பின் க,ச,த,ப, ங,ஞ,ந,ம, ய,வ வரலாம்.";
                    }
                    break;
                case 'க்': isValidCluster = (nextBase === 'க்'); ruleDescription = "'க்' ஒற்றின் பின் 'க' வர்க்கம் மட்டுமே வரும்."; break;
                case 'ச்': isValidCluster = (nextBase === 'ச்'); ruleDescription = "'ச்' ஒற்றின் பின் 'ச' வர்க்கம் மட்டுமே வரும்."; break;
                case 'த்': isValidCluster = (nextBase === 'த்'); ruleDescription = "'த்' ஒற்றின் பின் 'த' வர்க்கம் மட்டுமே வரும்."; break;
                case 'ப்': isValidCluster = (nextBase === 'ப்'); ruleDescription = "'ப்' ஒற்றின் பின் 'ப' வர்க்கம் மட்டுமே வரும்."; break;

                default: 
                    isValidCluster = true; 
            }

            if (!isValidCluster) {
                return {
                    title: "மெய்ம்மயக்க ஆய்வு",
                    isValid: false,
                    description: `பிழை: '${mei}' என்ற மெய்யைத் தொடர்ந்து '${nextChar}' வருவது மரபு அன்று. (${ruleDescription})`
                };
            }
        }

        // வெற்றிச் செய்தி (இங்குதான் முன்பு undefined வந்தது)
        return {
            title: "மெய்ம்மயக்க ஆய்வு",
            isValid: true,
            description: "சரி: சொல்லில் உள்ள மெய்ம்மயக்கங்கள் (Clusters) அனைத்தும் தொல்காப்பிய விதிகளுக்கு உட்பட்டுள்ளன."
        };
    }
};

// Helper Function
function getBaseConsonant(char) {
    const mapping = {
        'க': 'க்', 'கா': 'க்', 'கி': 'க்', 'கீ': 'க்', 'கு': 'க்', 'கூ': 'க்', 'கெ': 'க்', 'கே': 'க்', 'கை': 'க்', 'கொ': 'க்', 'கோ': 'க்', 'கௌ': 'க்', 'க்': 'க்',
        'ச': 'ச்', 'சா': 'ச்', 'சி': 'ச்', 'சீ': 'ச்', 'சு': 'ச்', 'சூ': 'ச்', 'செ': 'ச்', 'சே': 'ச்', 'சை': 'ச்', 'சொ': 'ச்', 'சோ': 'ச்', 'சௌ': 'ச்', 'ச்': 'ச்',
        'ட': 'ட்', 'டா': 'ட்', 'டி': 'ட்', 'டீ': 'ட்', 'டு': 'ட்', 'டூ': 'ட்', 'டெ': 'ட்', 'டே': 'ட்', 'டை': 'ட்', 'டொ': 'ட்', 'டோ': 'ட்', 'டௌ': 'ட்', 'ட்': 'ட்',
        'த': 'த்', 'தா': 'த்', 'தி': 'த்', 'தீ': 'த்', 'து': 'த்', 'தூ': 'த்', 'தெ': 'த்', 'தே': 'த்', 'தை': 'த்', 'தொ': 'த்', 'தோ': 'த்', 'தௌ': 'த்', 'த்': 'த்',
        'ப': 'ப்', 'பா': 'ப்', 'பி': 'ப்', 'பீ': 'ப்', 'பு': 'ப்', 'பூ': 'ப்', 'பெ': 'ப்', 'பே': 'ப்', 'பை': 'ப்', 'பொ': 'ப்', 'போ': 'ப்', 'பௌ': 'ப்', 'ப்': 'ப்',
        'ற': 'ற்', 'றா': 'ற்', 'றி': 'ற்', 'றீ': 'ற்', 'று': 'ற்', 'றூ': 'ற்', 'றெ': 'ற்', 'றே': 'ற்', 'றை': 'ற்', 'றொ': 'ற்', 'றோ': 'ற்', 'றௌ': 'ற்', 'ற்': 'ற்',
        'ஞ': 'ஞ்', 'ஞா': 'ஞ்', 'ஞி': 'ஞ்', 'ஞீ': 'ஞ்', 'ஞு': 'ஞ்', 'ஞூ': 'ஞ்', 'ஞெ': 'ஞ்', 'ஞே': 'ஞ்', 'ஞை': 'ஞ்', 'ஞொ': 'ஞ்', 'ஞோ': 'ஞ்', 'ஞௌ': 'ஞ்', 'ஞ்': 'ஞ்',
        'ங': 'ங்', 'ஙா': 'ங்', 'ஙி': 'ங்', 'ஙீ': 'ங்', 'ஙு': 'ங்', 'ஙூ': 'ங்', 'ஙெ': 'ங்', 'ஙே': 'ங்', 'ஙை': 'ங்', 'ஙொ': 'ங்', 'ஙோ': 'ங்', 'ஙௌ': 'ங்', 'ங்': 'ங்',
        'ண': 'ண்', 'ணா': 'ண்', 'ணி': 'ண்', 'ணீ': 'ண்', 'ணு': 'ண்', 'ணூ': 'ண்', 'ணெ': 'ண்', 'ணே': 'ண்', 'ணை': 'ண்', 'ணொ': 'ண்', 'ணோ': 'ண்', 'ணௌ': 'ண்', 'ண்': 'ண்',
        'ந': 'ந்', 'நா': 'ந்', 'நி': 'ந்', 'நீ': 'ந்', 'நு': 'ந்', 'நூ': 'ந்', 'நெ': 'ந்', 'நே': 'ந்', 'நை': 'ந்', 'நொ': 'ந்', 'நோ': 'ந்', 'நௌ': 'ந்', 'ந்': 'ந்',
        'ம': 'ம்', 'மா': 'ம்', 'மி': 'ம்', 'மீ': 'ம்', 'மு': 'ம்', 'மூ': 'ம்', 'மெ': 'ம்', 'மே': 'ம்', 'மை': 'ம்', 'மொ': 'ம்', 'மோ': 'ம்', 'மௌ': 'ம்', 'ம்': 'ம்',
        'ன': 'ன்', 'னா': 'ன்', 'னி': 'ன்', 'னீ': 'ன்', 'னு': 'ன்', 'னூ': 'ன்', 'னெ': 'ன்', 'னே': 'ன்', 'னை': 'ன்', 'னொ': 'ன்', 'னோ': 'ன்', 'னௌ': 'ன்', 'ன்': 'ன்',
        'ய': 'ய்', 'யா': 'ய்', 'யி': 'ய்', 'யீ': 'ய்', 'யு': 'ய்', 'யூ': 'ய்', 'யெ': 'ய்', 'யே': 'ய்', 'யை': 'ய்', 'யொ': 'ய்', 'யோ': 'ய்', 'யௌ': 'ய்', 'ய்': 'ய்',
        'ர': 'ர்', 'ரா': 'ர்', 'ரி': 'ர்', 'ரீ': 'ர்', 'ரு': 'ர்', 'ரூ': 'ர்', 'ரெ': 'ர்', 'ரே': 'ர்', 'ரை': 'ர்', 'ரொ': 'ர்', 'ரோ': 'ர்', 'ரௌ': 'ர்', 'ர்': 'ர்',
        'ல': 'ல்', 'லா': 'ல்', 'லி': 'ல்', 'லீ': 'ல்', 'லு': 'ல்', 'லூ': 'ல்', 'லெ': 'ல்', 'லே': 'ல்', 'லை': 'ல்', 'லொ': 'ல்', 'லோ': 'ல்', 'லௌ': 'ல்', 'ல்': 'ல்',
        'வ': 'வ்', 'வா': 'வ்', 'வி': 'வ்', 'வீ': 'வ்', 'வு': 'வ்', 'வூ': 'வ்', 'வெ': 'வ்', 'வே': 'வ்', 'வை': 'வ்', 'வொ': 'வ்', 'வோ': 'வ்', 'வௌ': 'வ்', 'வ்': 'வ்',
        'ழ': 'ழ்', 'ழா': 'ழ்', 'ழி': 'ழ்', 'ழீ': 'ழ்', 'ழு': 'ழ்', 'ழூ': 'ழ்', 'ழெ': 'ழ்', 'ழே': 'ழ்', 'ழை': 'ழ்', 'ழொ': 'ழ்', 'ழோ': 'ழ்', 'ழௌ': 'ழ்', 'ழ்': 'ழ்',
        'ள': 'ள்', 'ளா': 'ள்', 'ளி': 'ள்', 'ளீ': 'ள்', 'ளு': 'ள்', 'ளூ': 'ள்', 'ளெ': 'ள்', 'ளே': 'ள்', 'ளை': 'ள்', 'ளொ': 'ள்', 'ளோ': 'ள்', 'ளௌ': 'ள்', 'ள்': 'ள்'
    };

    return mapping[char] || null;
}
